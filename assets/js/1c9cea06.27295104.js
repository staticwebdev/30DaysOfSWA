"use strict";(self.webpackChunkwww=self.webpackChunkwww||[]).push([[890],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return d}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=l(n),d=r,h=m["".concat(p,".").concat(d)]||m[d]||c[d]||i;return n?a.createElement(h,o(o({ref:t},u),{},{components:n})):a.createElement(h,o({ref:t},u))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=m;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var l=2;l<i;l++)o[l]=n[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},6041:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return p},default:function(){return d},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return c}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),o=["components"],s={slug:"previewing-swa",title:"#06: Previewing SWA",authors:["nitya","michail"],tags:["swa","30days","core-concepts"],draft:!1},p=void 0,l={permalink:"/blog/previewing-swa",editUrl:"https://github.com/staticwebdev/30DaysOfSWA/tree/main/www/blog/2021-05-07.md",source:"@site/blog/2021-05-07.md",title:"#06: Previewing SWA",description:"Welcome to Week 1, Day 6 of #30DaysOfSWA!!",date:"2021-05-07T00:00:00.000Z",formattedDate:"May 7, 2021",tags:[{label:"swa",permalink:"/blog/tags/swa"},{label:"30days",permalink:"/blog/tags/30-days"},{label:"core-concepts",permalink:"/blog/tags/core-concepts"}],readingTime:6.425,truncated:!1,authors:[{name:"Nitya Narasimhan",title:"Senior Cloud Advocate @Microsoft",url:"https://twitter.com/nitya",imageURL:"https://github.com/nitya.png",key:"nitya"},{name:"Michail Shaposhnikov",title:"Software Engineer @Microsoft",url:"https://github.com/mishapos",imageURL:"https://github.com/mishapos.png",key:"michail"}],frontMatter:{slug:"previewing-swa",title:"#06: Previewing SWA",authors:["nitya","michail"],tags:["swa","30days","core-concepts"],draft:!1},nextItem:{title:"#05: Securing SWA",permalink:"/blog/securing-swa"}},u={authorsImageUrls:[void 0,void 0]},c=[{value:"What We&#39;ll Cover",id:"what-well-cover",level:2},{value:"Deployment Types",id:"deployment-types",level:2},{value:"Pull Requests",id:"pull-requests",level:2},{value:"Branches",id:"branches",level:2},{value:"Named Envs",id:"named-envs",level:2},{value:"Custom Domains",id:"custom-domains",level:2},{value:"How-Tos: Watch It!",id:"how-tos-watch-it",level:2},{value:"Exercise: Try it!",id:"exercise-try-it",level:2},{value:"Useful Resources",id:"useful-resources",level:2}],m={toc:c};function d(e){var t=e.components,s=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},m,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Welcome to ",(0,i.kt)("inlineCode",{parentName:"p"},"Week 1, Day 6")," of ",(0,i.kt)("strong",{parentName:"p"},"#30DaysOfSWA"),"!! "),(0,i.kt)("p",null,"We're almost at the end of week 1!! \ud83c\udf89 "),(0,i.kt)("p",null,"So far, we've learned how we can use the ",(0,i.kt)("em",{parentName:"p"},"static assets hosting")," (Azure Static Web Apps) and ",(0,i.kt)("em",{parentName:"p"},"serverless API")," (Azure Functions) capabilities to build and deploy a web application in a scalable and cost-effective way. And we learned to ",(0,i.kt)("em",{parentName:"p"},"configure")," and ",(0,i.kt)("em",{parentName:"p"},"secure")," our Static Web App to suit our needs. So what else do we need to talk about?"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Deployment")," options? Let's do it!! We've talked about the default experience so far: deploy from a ",(0,i.kt)("em",{parentName:"p"},"production")," branch, using ",(0,i.kt)("em",{parentName:"p"},"GitHub")," Actions for CI/CD. But how do we handle ",(0,i.kt)("strong",{parentName:"p"},"previewing")," the Static Web App before production deploys? Let's talk about previewing SWA in pull requests, on non-production branches, and in pre-configured named environments that make our staging workflows more productive."),(0,i.kt)("h2",{id:"what-well-cover"},"What We'll Cover"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"What types of deployment does SWA support?"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"Previewing"),": in Pull Requests"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"Previewing"),": in Non-Production Branches"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"Previewing"),": in Named Environments"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"Deploying"),": to Custom Domains"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Exercise:")," ",(0,i.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/static-web-apps/review-publish-pull-requests"},"Review PR using SWA Preview Capability"))),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(863).Z,width:"1000",height:"420"})),(0,i.kt)("h2",{id:"deployment-types"},"Deployment Types"),(0,i.kt)("p",null,"When we think about deployment, we are typically thinking of two kinds of environments: ",(0,i.kt)("em",{parentName:"p"},"production")," which serve as the primary endpoint for real world use, and ",(0,i.kt)("em",{parentName:"p"},"staging"),"  that can be used for internal testing, early validation of preview releases."),(0,i.kt)("p",null,"Azure Static Web Apps has built-in support for four types of environments:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"Production"),": This is the real world deployment endpoint that is ",(0,i.kt)("strong",{parentName:"li"},"indexed by search engines"),", and associated with the custom domain (if configured)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"Pull Request (PR)"),": This is a ",(0,i.kt)("strong",{parentName:"li"},"temporary")," environment setup for a Pull Request, and torn down when that PR is closed."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"Branch"),": This is a environment you can set up for non-production branches, at a ",(0,i.kt)("strong",{parentName:"li"},"stable")," URL for the lifetime of the branch."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"Named"),": The above environments have URLs that reflect their PR (number) or branch (name). You can also configure a ",(0,i.kt)("strong",{parentName:"li"},"stable")," preview environment with a fixed name, associated with some deployment context (e.g., an interim release)")),(0,i.kt)("p",null,"Production deploys have URLs like ",(0,i.kt)("inlineCode",{parentName:"p"},"<DEFAULT-HOSTNAME>-<NUMBER>.azurestaticapps.net")," where the ",(0,i.kt)("inlineCode",{parentName:"p"},"DEFAULT-HOSTNAME")," is unique for each application. "),(0,i.kt)("p",null,"With ",(0,i.kt)("em",{parentName:"p"},"preview")," environments, the URL looks like: ",(0,i.kt)("inlineCode",{parentName:"p"},"<DEFAULT_HOSTNAME>-<BRANCH_OR_ENVIRONMENT_NAME>.<LOCATION>.azurestaticapps.net")," where the ",(0,i.kt)("inlineCode",{parentName:"p"},"LOCATION")," reflects the deployment region, and the ",(0,i.kt)("inlineCode",{parentName:"p"},"BRANCH_OR_ENVIRONMENT_NAME")," can also take the form of a branch name, a named environment, or a number in the case of pull requests."),(0,i.kt)("p",null,"Let's take a brief look at each of these."),(0,i.kt)("h2",{id:"pull-requests"},"Pull Requests"),(0,i.kt)("p",null,"Currently Pull Request ",(0,i.kt)("em",{parentName:"p"},"preview environments")," are available for projects hosted in GitHub, and configured to use GitHub Actions by Azure Static Web Apps:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Every PR to a ",(0,i.kt)("em",{parentName:"li"},"watched branch")," gets a dedicated but ",(0,i.kt)("strong",{parentName:"li"},"temporary")," pre-production staging environment that is torn down when the PR is closed."),(0,i.kt)("li",{parentName:"ul"},"Use it to validate changes, perform sanity checks, etc."),(0,i.kt)("li",{parentName:"ul"},"The environment is automatically rebuilt and deployed if new commits are made to the branch associated with an active PR."),(0,i.kt)("li",{parentName:"ul"},"The staged environment is ",(0,i.kt)("em",{parentName:"li"},"publicly visible")," event if your GitHub repo is private - though the URL is not easily discoverable (i.e., not indexed by search engines) by default.")),(0,i.kt)("p",null,"Learn how to ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/static-web-apps/review-publish-pull-requests"},"preview Pull Requests in Azure Static Web Apps"),"."),(0,i.kt)("h2",{id:"branches"},"Branches"),(0,i.kt)("p",null,"Preview environments for branches will have ",(0,i.kt)("strong",{parentName:"p"},"stable")," URLs. Configure them in the relevant ",(0,i.kt)("em",{parentName:"p"},"GitHub Actions")," or ",(0,i.kt)("em",{parentName:"p"},"Azure Pipelines")," workflow files as ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/static-web-apps/branch-environments?tabs=github-actions#example"},"shown in this example"),". "),(0,i.kt)("p",null,"For example, in a GitHub Actions context, this involves two steps:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"set the ",(0,i.kt)("inlineCode",{parentName:"li"},"production_branch")," property to the branch you want to use as the source for that production deployment."),(0,i.kt)("li",{parentName:"ul"},"list all other branches that you want preview environments for under ",(0,i.kt)("inlineCode",{parentName:"li"},"trigger")," (Azure Pipelines) or ",(0,i.kt)("inlineCode",{parentName:"li"},"push: branches")," (in GitHub Actions).")),(0,i.kt)("p",null,"You can use a wildcare (",(0,i.kt)("inlineCode",{parentName:"p"},"**")," for GitHub Actions, ",(0,i.kt)("inlineCode",{parentName:"p"},"*")," for Azure Pipelines) if you want to track ",(0,i.kt)("em",{parentName:"p"},"all")," branches for preview environment support. "),(0,i.kt)("p",null,"Here's an example GitHub Actions config file - the ",(0,i.kt)("strong",{parentName:"p"},"production")," environment is built from the ",(0,i.kt)("em",{parentName:"p"},"main")," branch, and separate ",(0,i.kt)("strong",{parentName:"p"},"preview")," environments are built for the other listed branches (",(0,i.kt)("em",{parentName:"p"},"dev")," and ",(0,i.kt)("em",{parentName:"p"},"staging"),")."),(0,i.kt)("p",null,"Learn how to ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/static-web-apps/branch-environments?tabs=github-actions"},"create branch preview environments in Azure Static Web Apps"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'name: Azure Static Web Apps CI/CD\n\non:\n  push:\n    branches:\n      - main\n      - dev\n      - staging\n  pull_request:\n    types: [opened, synchronize, reopened, closed]\n    branches:\n      - main\n\njobs:\n  build_and_deploy_job:\n    ...\n    name: Build and Deploy Job\n    steps:\n      - uses: actions/checkout@v2\n        with:\n          submodules: true\n      - name: Build And Deploy\n        id: builddeploy\n        uses: Azure/static-web-apps-deploy@v1\n        with:\n          ...\n          production_branch: "main"\n')),(0,i.kt)("h2",{id:"named-envs"},"Named Envs"),(0,i.kt)("p",null,"Sometimes, you want to have a non-production preview environment that is at ",(0,i.kt)("em",{parentName:"p"},"stable")," URL (not tied to a specific PR number or branch name), and that gets rebuilt on commits to ",(0,i.kt)("em",{parentName:"p"},"all tracked branches")," in the configuration file. "),(0,i.kt)("p",null,"Just like with branches, this requires a manual change to your default configuration file (GitHub Actions or Azure Pipelines) as ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/static-web-apps/named-environments?tabs=github-actions#configuration"},"shown in this example"),"."),(0,i.kt)("p",null,"In the GitHub Actions case, the steps are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Set the ",(0,i.kt)("inlineCode",{parentName:"li"},"deployment_environment")," property (in the relevant build job) to be the ",(0,i.kt)("strong",{parentName:"li"},"name")," you want to use for this preview environment"),(0,i.kt)("li",{parentName:"ul"},"List the branches you want associated with this named environment under ",(0,i.kt)("inlineCode",{parentName:"li"},"push: branches")," - commits to those will result in rebuild/deploy to this environment.")),(0,i.kt)("p",null,"Here's an example GitHub Actions configuration file - this sets up a named environment called ",(0,i.kt)("strong",{parentName:"p"},"release")," which gets updated when changes are made to ",(0,i.kt)("strong",{parentName:"p"},"any")," branch (reflected by the ",(0,i.kt)("inlineCode",{parentName:"p"},"**")," wildcard), and deployed to a site with a URL like ",(0,i.kt)("inlineCode",{parentName:"p"},"<DEFAULT_HOST_NAME>-release.<LOCATION>.azurestaticapps.net"),"."),(0,i.kt)("p",null,"Learn about ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/static-web-apps/named-environments?tabs=github-actions"},"named preview environments in Azure Static Web Apps")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'name: Azure Static Web Apps CI/CD\n\non:\n  push:\n    branches:\n      - "**"\n  pull_request:\n    types: [opened, synchronize, reopened, closed]\n    branches:\n      - main\n\njobs:\n  build_and_deploy_job:\n    ...\n    name: Build and Deploy Job\n    steps:\n      - uses: actions/checkout@v2\n        with:\n          submodules: true\n      - name: Build And Deploy\n        id: builddeploy\n        uses: Azure/static-web-apps-deploy@v1\n        with:\n          ...\n          deployment_environment: "release"\n')),(0,i.kt)("h2",{id:"custom-domains"},"Custom Domains"),(0,i.kt)("p",null,"You may have noticed that default deployment URLs - in the form ",(0,i.kt)("inlineCode",{parentName:"p"},"XXX.azurestaticapps.net")," for production environments or ",(0,i.kt)("inlineCode",{parentName:"p"},"XXX.<LOCATION>.azurestaticapps.net")," for preview environments - are not exactly user friendly for use and recall. "),(0,i.kt)("p",null,"Adding a custom domain helps. Azure Static Apps makes that easy with options to also configure ",(0,i.kt)("strong",{parentName:"p"},"subdomains")," and an ",(0,i.kt)("strong",{parentName:"p"},"apex domain"),"! Here, given a domain like ",(0,i.kt)("inlineCode",{parentName:"p"},"www.azure.com"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"azure.com")," is the apex domain and ",(0,i.kt)("inlineCode",{parentName:"p"},"www")," is the relevant subdomain."),(0,i.kt)("p",null,"So how do you configure these? You have two options:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Use an ",(0,i.kt)("strong",{parentName:"li"},"external DNS Provider")," (if your domain registrar supports it)"),(0,i.kt)("li",{parentName:"ul"},"Use ",(0,i.kt)("strong",{parentName:"li"},"Azure DNS")," (to manage your DNS domain, even if purchased elsewhere)")),(0,i.kt)("p",null,"To keep this post short, we won't go into details for each of these options. Instead check out these links based on the direction you want to go in:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Setup Apex Domain - with ",(0,i.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/static-web-apps/apex-domain-azure-dns"},"Azure DNS")," | with ",(0,i.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/static-web-apps/apex-domain-external"},"External Provider")),(0,i.kt)("li",{parentName:"ul"},"Setup Subdomain - with ",(0,i.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/static-web-apps/custom-domain-azure-dns"},"Azure DNS")," | with ",(0,i.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/static-web-apps/custom-domain-external"},"External Provider"))),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"how-tos-watch-it"},"How-Tos: Watch It!"),(0,i.kt)("p",null,"Prefer a Video Walkthrough to understand the process? We have you covered with the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/shows/azure-tips-and-tricks-static-web-apps/"},"Azure Tips And Tricks: Static Web Apps")," series. Check out this video to understand how you can setup a custom domain for your Static Web App!"),(0,i.kt)("iframe",{width:"560",height:"315",frameborder:"0",src:"https://aka.ms/docs/player?show=azure-tips-and-tricks-static-web-apps&ep=how-to-set-up-a-custom-domain-name-in-azure-static-web-apps-10-of-16--azure-tips-and-tricks-static-w"}),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"exercise-try-it"},"Exercise: Try it!"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Pull Requests")," are critical to having a productive open source or multi-contributor project, so it's important to know how Azure Static Apps works in setting up ",(0,i.kt)("strong",{parentName:"p"},"pre-production")," environments for validating the changes proposed in a pull-request, before merging it for production deployment."),(0,i.kt)("p",null,"Get hands-on experience with the process by completing ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/static-web-apps/review-publish-pull-requests"},"this tutorial")," on an existing Azure Static Web Apps project. "),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"At present, the staged pre-production environment for Pull Requests is available only for GitHub Actions deployments - so make sure you pick a GitHub-hosted SWA project that already had the default workflows set up"),"."),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"useful-resources"},"Useful Resources"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/static-web-apps/preview-environments"},"Preview environments in Azure Static Web Apps")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/static-web-apps/review-publish-pull-requests"},"Pull-Request Preview Environments")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/static-web-apps/branch-environments"},"Branch Preview Environments")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/static-web-apps/named-environments"},"Named Preview Environments")),(0,i.kt)("li",{parentName:"ol"},"Video Series: ",(0,i.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/shows/azure-tips-and-tricks-static-web-apps/"},"Azure Tips And Tricks - Static Web Apps")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/static-web-apps/custom-domain"},"About Custom Domains"))))}d.isMDXComponent=!0},863:function(e,t,n){t.Z=n.p+"assets/images/06-banner-94bc0f608367c239030f3ab3a9fa79cc.png"}}]);