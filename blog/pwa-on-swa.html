<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.20">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Azure Static Web Apps RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Azure Static Web Apps Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XQTX19ZF9V"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XQTX19ZF9V",{anonymize_ip:!0})</script><title data-rh="true">#13: Hosting PWA on Static Web Apps | Azure Static Web Apps</title><meta data-rh="true" property="og:image" content="https://www.azurestaticwebapps.dev/img/logo.png"><meta data-rh="true" property="og:url" content="https://www.azurestaticwebapps.dev/blog/pwa-on-swa"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="twitter:url" content="https://aka.ms/30DaysOfSWA"><meta data-rh="true" name="twitter:title" content="Learn Azure Static Web Apps in #30DaysOfSWA"><meta data-rh="true" name="twitter:description" content="Learn @AzureStaticApps from Core Concepts to Best Practices in #30DaysOfSWA at https://aka.ms/30DaysOfSWA"><meta data-rh="true" name="twitter:image" content="https://www.azurestaticwebapps.dev/assets/images/series-people-13a2856edd7022e82a252ed05dffbabc.png"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" name="twitter:creator" content="@nitya"><meta data-rh="true" name="twitter:site" content="@AzureStaticApps"><meta data-rh="true" property="og:title" content="#13: Hosting PWA on Static Web Apps | Azure Static Web Apps"><meta data-rh="true" name="description" content="Welcome to Week 2, Day 6 of #30DaysOfSWA!!"><meta data-rh="true" property="og:description" content="Welcome to Week 2, Day 6 of #30DaysOfSWA!!"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-05-14T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://twitter.com/webmaxru"><meta data-rh="true" property="article:tag" content="swa,30days,usage-examples"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.azurestaticwebapps.dev/blog/pwa-on-swa"><link data-rh="true" rel="alternate" href="https://www.azurestaticwebapps.dev/blog/pwa-on-swa" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.azurestaticwebapps.dev/blog/pwa-on-swa" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.061b8712.css">
<link rel="preload" href="/assets/js/runtime~main.8b704e5e.js" as="script">
<link rel="preload" href="/assets/js/main.a80bf38b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><div class="announcementBar_IbjG" style="background-color:#50E6FF;color:#552F99" role="banner"><div class="announcementBarContent_KsVm"><b>Found this project helpful? Give us a star on <a href="https://aka.ms/30DaysOfSWA/github"><b>GitHub</b></a></b> üôèüèΩ</div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/svg/logo.svg" alt="#30DaysOfSWA Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/svg/logo.svg" alt="#30DaysOfSWA Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title text--truncate">Static Web Apps!</b></a><a class="navbar__item navbar__link" href="/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/thismonth">Roundup</a><a class="navbar__item navbar__link" href="/showcase">Showcase</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/resources">Docs</a><a href="https://portal.azure.com/?feature.customportal=false&amp;WT.mc_id=30daysofswa-61155-ninarasi#create/Microsoft.StaticApp" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Deploy</a><a href="https://github.com/staticwebdev/30DaysOfSWA" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_dLyj"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_TMXw thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_V4zb margin-bottom--md">Most Recent Posts</div><ul class="sidebarItemList_uHd5 clean-list"><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/30days-summary">#29: Learn in #30Days</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/practices-full-stack-react">#28: Full-Stack SWA: React + Mongoose</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/practices-cosmosdb">#27: Video Conf with ACS &amp; SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/practices-byo-functions">#26: Azure Functions &amp; SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/practices-case-study">#25: KlipTok &amp; SWA: Case Study</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/practices-cognitive-services">#24: Cognitive Services &amp; SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/practices-cognitive-search">#23: Cognitive Search &amp; SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/practices-e2e">#22: E2E Development &amp; SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/devtools-vscode">#21: Develop With VSCode</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/devtools-swacli-deploy">#20: Deploy with SWA CLI</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/devtools-swacli-develop">#19: Develop with SWA CLI</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/devtools-msedge">#18: Debug with Edge DevTools</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/devtools-ado">#17: Multi-Stage Deploy with ADO</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/devtools-playwright">#16: Test Automation with Playwright</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/devtools-azure">#15: Develop with Azure Tools</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/show-and-tell">#14: Show &amp; Tell: A SWArm Of Apps</a></li><li class="sidebarItem_spIe"><a aria-current="page" class="sidebarItemLink_eqrF sidebarItemLinkActive_XZSJ" href="/blog/pwa-on-swa">#13: Hosting PWA on Static Web Apps</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/build-with-blazor">#12: Headless CMS &amp; Blazor SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/build-with-docusaurus">#11: Share Content - with Docusaurus</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/build-with-vuejs">#10: Get Creative - with Vue.js</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/build-with-react">#09: Manage Inventory - with React</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/build-with-astro">#08: Build A Blog - with Astro</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/deploying-swa">#07: Deploying SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/previewing-swa">#06: Previewing SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/securing-swa">#05: Securing SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/configuring-swa">#04: Configuring SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/api-enabling-swa">#03: API-Enabling SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/building-swa">#02: Building SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/introducing-swa">#01: Introducing SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/kickoff">Kickoff #30DaysOfSWA!</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/swanniversary">It&#x27;s the SWA-anniversary!!</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_rzP5" itemprop="headline">#13: Hosting PWA on Static Web Apps</h1><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-05-14T00:00:00.000Z" itemprop="datePublished">May 14, 2022</time> ¬∑ <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://twitter.com/webmaxru" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/webmaxru.png" alt="Maxim Salnikov"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/webmaxru" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Maxim Salnikov</span></a></div><small class="avatar__subtitle" itemprop="description">Developer Relations @Microsoft</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>Welcome to <code>Week 2, Day 6</code> of <strong>#30DaysOfSWA</strong>!! </p><p>Yesterday we talked about deploying Blazor apps on Static Web Apps. Let&#x27;s continue today with one more type of the projects you can successfully host on SWA - Progressive Web Apps (PWAs).</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="what-well-cover">What We&#x27;ll Cover<a class="hash-link" href="#what-well-cover" title="Direct link to heading">‚Äã</a></h2><ul><li>How do I start with building a PWA?</li><li>Optimized PWA-on-SWA configuration</li><li>Advanced techniques for better user experience</li><li><strong>Exercise:</strong> <a href="https://github.com/webmaxru/pwa-on-swa" target="_blank" rel="noopener noreferrer">Deploy your PWA on SWA, run offline, and install it</a></li></ul><p><img loading="lazy" src="/assets/images/13-banner-3cf47c138a827b17cf3cafad0071cc35.png" width="1000" height="420" class="img_E7b_"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="progressive-web-applications">Progressive Web Applications<a class="hash-link" href="#progressive-web-applications" title="Direct link to heading">‚Äã</a></h2><p>A <strong>Progressive Web App (PWA)</strong> is a web frontend application that is progressively enhanced using open web technologies, to make sure it delivers the best possible experience on every device, based on available capabilities. The &quot;baseline&quot; for your app to have a title &quot;progressive&quot; is its installability and offline-readiness. We skip the &quot;served with https&quot; requirement because it became a baseline for any web app these days.</p><p><img loading="lazy" alt="#30DaysOfPWA - Core Concepts" src="/assets/images/13-pwa-30days-49b1548a61b0171a30f832e32d493c75.jpg" width="880" height="495" class="img_E7b_"></p><p>This chapter of #30DaysOfSWA assumes that you are familiar with the basic concepts of a Service Worker API and automating your service worker with the Workbox library. If you wish to learn about these technologies, you are welcome to go through the Core Concepts part of the <strong><a href="https://aka.ms/30DaysOfPWA" target="_blank" rel="noopener noreferrer">#30DaysOfPWA</a></strong> project (see roadmap above) to learn about PWA fundamentals and to watch <strong><a href="https://www.youtube.com/watch?v=LILGt_pHk9M&amp;ab_channel=NDCConferences" target="_blank" rel="noopener noreferrer">Automating a service worker with the Workbox 6</a></strong> video for quickstart with Workbox.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="is-hosting-a-pwa-on-azure-static-web-apps-different-from-classic-apps">Is hosting a PWA on Azure Static Web Apps different from &quot;classic&quot; apps?<a class="hash-link" href="#is-hosting-a-pwa-on-azure-static-web-apps-different-from-classic-apps" title="Direct link to heading">‚Äã</a></h2><p>A Progressive Web Application is still a web frontend app so the initial scaffolding of your SWA resource is the same - you have learned how to deploy and configure various types of web apps from the previous chapters of the #30DaysOfSWA. But to make sure that your &quot;PWA on SWA&quot; works as intended both online &amp; offline to provide the best possible user &amp; developer experiences, you might need to pay special attention to some implementation details and fine-tune some configuration options. We&#x27;ll go through the following points in this chapter:</p><ul><li>Building your service worker as a part of the overall app build</li><li>Setting up HTML5 routing - for the Single-Page Application (SPA) use-case</li><li>Applying caching strategies for SWA-hosted APIs</li><li>Showing custom error pages</li><li>How to deal with authentication in PWA</li></ul><p><strong>Sample project</strong></p><p>I created a <strong><a href="https://github.com/webmaxru/pwa-on-swa" target="_blank" rel="noopener noreferrer">PWA on SWA Starter</a></strong> project with all the best practices implemented. The app is <a href="https://aka.ms/pwa-on-swa" target="_blank" rel="noopener noreferrer">hosted on SWA</a> as shown below. Let&#x27;s explore it!</p><p><img loading="lazy" alt="PWA Starter on SWA" src="/assets/images/13-pwa-starter-a1635fd2b9c0d9f831010de9313f729e.png" width="1123" height="889" class="img_E7b_"></p><p><strong>Technical stack:</strong></p><ul><li>A React application scaffolded by the <a href="https://reactjs.org/docs/create-a-new-react-app.html" target="_blank" rel="noopener noreferrer">create-react-app</a> tool. A simple SPA with a few routes and the possibility to call API endpoints. Note that the approaches described are applicable for any web frontend application: <strong>framework-based</strong> (including your custom frameworks) or <strong>&quot;vanilla&quot; JavaScript</strong>. We use React only for getting closer to the real-world scenario of the modern frontend app development when you have to perform some operations with your source code (&quot;build the app&quot;) before the deployment.</li><li>A <a href="https://github.com/webmaxru/pwa-on-swa/blob/main/src/sw/service-worker.js" target="_blank" rel="noopener noreferrer">service worker</a> powered by the <a href="https://workboxjs.org" target="_blank" rel="noopener noreferrer">Workbox</a> library.</li><li>Two API endpoints created within SWA resource - to emulate &quot;dynamic&quot; (<code>/api/news</code>) and &quot;conservative&quot; (<code>/api/archives</code>) data sources.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="building-your-service-worker-as-a-part-of-the-overall-app-build">Building your service worker as a part of the overall app build<a class="hash-link" href="#building-your-service-worker-as-a-part-of-the-overall-app-build" title="Direct link to heading">‚Äã</a></h2><p>The service worker file we have in the <code>src/sw</code> folder of the application is not ready for the deployment. We have to</p><ol><li><strong><a href="https://github.com/webmaxru/pwa-on-swa/blob/main/scripts/sw-build.js" target="_blank" rel="noopener noreferrer">Process it</a></strong> by the <code>workbox-build</code> module to populate with the resources to precache (to provide offline-readiness)</li><li><strong>Bundle it</strong></li><li><strong>Choose</strong> production or development mode</li><li><strong>Minify</strong> for deployment</li></ol><p>This is why in <code>package.json</code>&#x27;s <code>scripts</code> we have <code>&quot;build-sw&quot;: &quot;node scripts/sw-build.js &amp;&amp; npx rollup -c&quot;</code> command that is building a service worker file and copies it into the app distribution folder.</p><p>By default, Azure Static Web Apps runs <code>npm run build</code> command to build your application. So do not forget to add a service worker build command there. The resulting  command will be:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;build&quot;: &quot;react-scripts build &amp;&amp; npm run build-sw&quot;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Instead of <code>react-scripts build</code>, there might be a command to build an application using a framework/bundler of your choice. <strong>Important</strong>: Keep this order - you always build a service worker <em>after</em> the main application because the distribution folder will be scanned to list the files to precache based on the <a href="https://github.com/webmaxru/pwa-on-swa/blob/main/scripts/sw-build.js#L5" target="_blank" rel="noopener noreferrer">pattern</a> you provided.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="setting-up-html5-routing---for-the-single-page-application-spa">Setting up HTML5 routing - for the Single-Page Application (SPA)<a class="hash-link" href="#setting-up-html5-routing---for-the-single-page-application-spa" title="Direct link to heading">‚Äã</a></h2><p>For having correct navigation in your single-page application, you have to &quot;ask&quot; the webserver to redirect all navigation requests to <code>index.html</code> - to run the application and let it do the routing. In SWA, you have to have something like this in the <a href="https://github.com/webmaxru/pwa-on-swa/blob/main/staticwebapp.config.json" target="_blank" rel="noopener noreferrer">configuration file</a>:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;navigationFallback&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;rewrite&quot;: &quot;index.html&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;exclude&quot;: [&quot;/images/*.{png,jpg,gif}&quot;, &quot;/static/*&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Best practices</strong>:</p><ul><li>Always &quot;exclude&quot; as much as possible in <code>navigationFallback</code> - it will help you to identify and fix &quot;resource not found&quot; errors.</li><li>Do not copy <code>staticwebapp.config.json</code> to the app distribution folder - SWA will find it in any location within the app source code.</li></ul><p>In case of PWA, there is an extra layer of this fallback: the first in a row to handle navigation requests is a service worker. In the <a href="https://github.com/webmaxru/pwa-on-swa/blob/main/src/sw/service-worker.js" target="_blank" rel="noopener noreferrer">service-worker.js</a> we have to have the following block for correct routing in SPAs:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">const navHandler = createHandlerBoundToURL(&#x27;/index.html&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const navigationRoute = new NavigationRoute(navHandler, {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  denylist: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    new RegExp(&#x27;^/images/&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    new RegExp(&#x27;^/static/&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">registerRoute(navigationRoute);</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above configuration will work fine for opening both root url and &quot;deep links&quot; like <code>/about</code> both in online and offline modes. </p><h2 class="anchor anchorWithStickyNavbar_mojV" id="showing-custom-error-pages">Showing custom error pages<a class="hash-link" href="#showing-custom-error-pages" title="Direct link to heading">‚Äã</a></h2><p>It&#x27;s a best practice to create and show custom error pages (for example for 404 Not Found) instead of the ones built-in in the browsers. And it makes sense to keep these pages as simple as possible - without running a SPA itself. To set up custom error pages, you add the following block to the <a href="https://github.com/webmaxru/pwa-on-swa/blob/main/staticwebapp.config.json" target="_blank" rel="noopener noreferrer">SWA config</a></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;responseOverrides&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;400&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;rewrite&quot;: &quot;/400.html&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;404&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;rewrite&quot;: &quot;/404.html&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>These pages will be excluded from SWA&#x27;s navigation fallback automatically because these two html are in the app distribution folder. But for the Workbox and explicit directive needed - just add these addresses to the same <code>denylist</code> we met with the HTML5 navigation section.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="applying-caching-strategies-for-swa-hosted-apis">Applying caching strategies for SWA-hosted APIs<a class="hash-link" href="#applying-caching-strategies-for-swa-hosted-apis" title="Direct link to heading">‚Äã</a></h2><p>With Workbox, runtime caching is simple: you specify a url pattern to &quot;listen&quot; and intercept, and a caching strategy to apply. There are <a href="https://developer.chrome.com/docs/workbox/modules/workbox-strategies/" target="_blank" rel="noopener noreferrer">5 strategies</a> available and you can always create a custom one. By default, all API urls start with <code>/api</code>. Then in a <a href="https://github.com/webmaxru/pwa-on-swa/blob/main/src/sw/service-worker.js" target="_blank" rel="noopener noreferrer">service worker</a>, we&#x27;ll add this block for caching responses from our two API endpoints using different strategies:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">registerRoute(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ({ url }) =&gt; url.pathname.startsWith(&#x27;/api/news&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  new NetworkFirst()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">registerRoute(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ({ url }) =&gt; url.pathname.startsWith(&#x27;/api/archives&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  new CacheFirst()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, the data from APIs, once fetched, is also available offline!</p><p><strong>Mini-exercise</strong>: Open the <a href="https://aka.ms/pwa-on-swa" target="_blank" rel="noopener noreferrer">hosted PWA on SWA Starter</a>, open the Network tab of DevTools, and click on two buttons in the &quot;API caching&quot; demo area. What difference do you see in the network request/response patterns for these two strategies?</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="how-to-deal-with-authentication-in-pwa">How to deal with authentication in PWA<a class="hash-link" href="#how-to-deal-with-authentication-in-pwa" title="Direct link to heading">‚Äã</a></h2><p>A couple of <strong>important</strong> rules here:</p><ol><li>Explicitly exclude the <code>.auth</code> system folder of SWA from Workbox&#x27;s navigation fallback (use <code>denylist</code>) and never set up runtime caching for it</li><li>Never runtime-cache all data users fetch from restricted API endpoints (served by SWA or external)</li></ol><p>And it&#x27;s a <strong>best practice</strong> to never precache and always exclude from the service worker&#x27;s navigation fallback all urls related to the user authentication and restricted parts of your application. <a href="https://github.com/webmaxru/pwa-on-swa/blob/main/src/sw/service-worker.js#L27" target="_blank" rel="noopener noreferrer">Have a look</a> at the resulting <code>denylist</code> of our sample application.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="exercise-deploy-your-pwa-on-swa-run-offline-and-install-it">Exercise: Deploy your PWA on SWA, run offline, and install it!<a class="hash-link" href="#exercise-deploy-your-pwa-on-swa-run-offline-and-install-it" title="Direct link to heading">‚Äã</a></h2><p>Hopefully, you&#x27;re ready to try something fun that will reinforce what you learned today. </p><p>For this exercise:</p><ul><li><a href="https://github.com/webmaxru/pwa-on-swa" target="_blank" rel="noopener noreferrer">Fork the PWA on SWA Starter repository</a> and deploy it to Azure Static Web Apps using the skills you gained in the previous chapters of the #30DaysOfSWA</li><li>Open the url you received after the SWA resource was created</li><li>Now, go offline (disconnect from the Internet or emulate offline mode in the DevTools) and reload the page - it still works!</li><li>Using the &quot;App available&quot; icon on the right-hand side of the desktop browser&#x27;s address bar, install the application on your laptop - now it behaves like a native one!</li></ul><hr><h2 class="anchor anchorWithStickyNavbar_mojV" id="resources">Resources<a class="hash-link" href="#resources" title="Direct link to heading">‚Äã</a></h2><p>Here are some resources to get you started with your Progressive Web App journey into </p><ul><li><a href="https://aka.ms/learn-pwa" target="_blank" rel="noopener noreferrer">PWA on Microsoft Docs</a></li><li><a href="https://aka.ms/30DaysOfPWA" target="_blank" rel="noopener noreferrer">#30DaysOfPWA</a></li><li><a href="https://workboxjs.org" target="_blank" rel="noopener noreferrer">Workbox library</a></li></ul></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_h6_j"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/swa">swa</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/30-days">30days</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/usage-examples">usage-examples</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/show-and-tell"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">#14: Show &amp; Tell: A SWArm Of Apps</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/build-with-blazor"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">#12: Headless CMS &amp; Blazor SWA</div></a></nav></main><div class="col col--2"><div class="tableOfContents_cNA8 thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-well-cover" class="table-of-contents__link toc-highlight">What We&#39;ll Cover</a></li><li><a href="#progressive-web-applications" class="table-of-contents__link toc-highlight">Progressive Web Applications</a></li><li><a href="#is-hosting-a-pwa-on-azure-static-web-apps-different-from-classic-apps" class="table-of-contents__link toc-highlight">Is hosting a PWA on Azure Static Web Apps different from &quot;classic&quot; apps?</a></li><li><a href="#building-your-service-worker-as-a-part-of-the-overall-app-build" class="table-of-contents__link toc-highlight">Building your service worker as a part of the overall app build</a></li><li><a href="#setting-up-html5-routing---for-the-single-page-application-spa" class="table-of-contents__link toc-highlight">Setting up HTML5 routing - for the Single-Page Application (SPA)</a></li><li><a href="#showing-custom-error-pages" class="table-of-contents__link toc-highlight">Showing custom error pages</a></li><li><a href="#applying-caching-strategies-for-swa-hosted-apis" class="table-of-contents__link toc-highlight">Applying caching strategies for SWA-hosted APIs</a></li><li><a href="#how-to-deal-with-authentication-in-pwa" class="table-of-contents__link toc-highlight">How to deal with authentication in PWA</a></li><li><a href="#exercise-deploy-your-pwa-on-swa-run-offline-and-install-it" class="table-of-contents__link toc-highlight">Exercise: Deploy your PWA on SWA, run offline, and install it!</a></li><li><a href="#resources" class="table-of-contents__link toc-highlight">Resources</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 Microsoft  - Built with <a href="https://docusaurus.io"> Docusaurus </a> - Deployed to <a href="https://aka.ms/swa"> Azure </a> - Created by <a href="https://github.com/nitya"> @nitya </a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.8b704e5e.js"></script>
<script src="/assets/js/main.a80bf38b.js"></script>
</body>
</html>