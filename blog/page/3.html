<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.20">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Azure Static Web Apps RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Azure Static Web Apps Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XQTX19ZF9V"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XQTX19ZF9V",{anonymize_ip:!0})</script><title data-rh="true">Blog | Azure Static Web Apps</title><meta data-rh="true" property="og:image" content="https://www.azurestaticwebapps.dev/img/logo.png"><meta data-rh="true" property="og:url" content="https://www.azurestaticwebapps.dev/blog/page/3"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Blog | Azure Static Web Apps"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="twitter:url" content="https://www.azurestaticwebapps.dev/blog/practices-cosmosdb"><meta data-rh="true" name="twitter:title" content="#27: Video Conferencing with ACS &amp; SWA"><meta data-rh="true" name="twitter:description" content="Join @davrous on #30DaysOfSWA as builds an auth workflow for video conferencing with @AzureStatic Apps @AzureFunctions @AzureCosmosDB &amp; Azure Communications Services!"><meta data-rh="true" name="twitter:image" content="https://www.azurestaticwebapps.dev/assets/images/27-banner.png"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" name="twitter:creator" content="@nitya"><meta data-rh="true" name="twitter:site" content="@AzureStaticApps"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="alternate" href="https://www.azurestaticwebapps.dev/blog/page/3" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.azurestaticwebapps.dev/blog/page/3" hreflang="x-default"><link data-rh="true" rel="canonical" href="https://www.azurestaticwebapps.dev/blog/practices-cosmosdb"><link rel="stylesheet" href="/assets/css/styles.061b8712.css">
<link rel="preload" href="/assets/js/runtime~main.cbde678b.js" as="script">
<link rel="preload" href="/assets/js/main.a80bf38b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><div class="announcementBar_IbjG" style="background-color:#50E6FF;color:#552F99" role="banner"><div class="announcementBarContent_KsVm"><b>Found this project helpful? Give us a star on <a href="https://aka.ms/30DaysOfSWA/github"><b>GitHub</b></a></b> üôèüèΩ</div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/svg/logo.svg" alt="#30DaysOfSWA Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/svg/logo.svg" alt="#30DaysOfSWA Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title text--truncate">Static Web Apps!</b></a><a class="navbar__item navbar__link" href="/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/thismonth">Roundup</a><a class="navbar__item navbar__link" href="/showcase">Showcase</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/resources">Docs</a><a href="https://portal.azure.com/?feature.customportal=false&amp;WT.mc_id=30daysofswa-61155-ninarasi#create/Microsoft.StaticApp" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Deploy</a><a href="https://github.com/staticwebdev/30DaysOfSWA" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_dLyj"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_TMXw thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_V4zb margin-bottom--md">Most Recent Posts</div><ul class="sidebarItemList_uHd5 clean-list"><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/30days-summary">#29: Learn in #30Days</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/practices-full-stack-react">#28: Full-Stack SWA: React + Mongoose</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/practices-cosmosdb">#27: Video Conf with ACS &amp; SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/practices-byo-functions">#26: Azure Functions &amp; SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/practices-case-study">#25: KlipTok &amp; SWA: Case Study</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/practices-cognitive-services">#24: Cognitive Services &amp; SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/practices-cognitive-search">#23: Cognitive Search &amp; SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/practices-e2e">#22: E2E Development &amp; SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/devtools-vscode">#21: Develop With VSCode</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/devtools-swacli-deploy">#20: Deploy with SWA CLI</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/devtools-swacli-develop">#19: Develop with SWA CLI</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/devtools-msedge">#18: Debug with Edge DevTools</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/devtools-ado">#17: Multi-Stage Deploy with ADO</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/devtools-playwright">#16: Test Automation with Playwright</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/devtools-azure">#15: Develop with Azure Tools</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/show-and-tell">#14: Show &amp; Tell: A SWArm Of Apps</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/pwa-on-swa">#13: Hosting PWA on Static Web Apps</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/build-with-blazor">#12: Headless CMS &amp; Blazor SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/build-with-docusaurus">#11: Share Content - with Docusaurus</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/build-with-vuejs">#10: Get Creative - with Vue.js</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/build-with-react">#09: Manage Inventory - with React</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/build-with-astro">#08: Build A Blog - with Astro</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/deploying-swa">#07: Deploying SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/previewing-swa">#06: Previewing SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/securing-swa">#05: Securing SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/configuring-swa">#04: Configuring SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/api-enabling-swa">#03: API-Enabling SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/building-swa">#02: Building SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/introducing-swa">#01: Introducing SWA</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/kickoff">Kickoff #30DaysOfSWA!</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/blog/swanniversary">It&#x27;s the SWA-anniversary!!</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/blog/practices-cosmosdb">#27: Video Conf with ACS &amp; SWA</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-05-28T00:00:00.000Z" itemprop="datePublished">May 28, 2022</time> ¬∑ <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://github.com/davrous" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/davrous.png" alt="David Rousset"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/davrous" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">David Rousset</span></a></div><small class="avatar__subtitle" itemprop="description">Senior Program Manager @Microsoft</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Welcome to <code>Week 4, Day 6</code> of <strong>#30DaysOfSWA</strong>!! </p><p>In an earlier example this week, we looked at a real-world case study with KlipTok, involving Azure Static Web Apps integration with <em>multiple</em> backend services, to deliver the desired user experience. Today we look at another great example of an end-to-end development workflow that involves multiple service integrations - this time with a focus on deliver a rich video conferencing web application experience. Let&#x27;s learn how to build this with <strong>a workflow that involves Azure Static Web Apps, Azure Functions, Azure CosmosDB - and Azure Communications Services (ACS)</strong>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="what-well-cover">What We&#x27;ll Cover<a class="hash-link" href="#what-well-cover" title="Direct link to heading">‚Äã</a></h2><ul><li>What is Azure Communications Services (ACS)?</li><li>The Video Conference Authentication Workflow<ul><li>Azure Static Web Apps for social authentication</li><li>Azure CosmosDB to store ACS identity information</li><li>Azure Functions to map social auth to ACS identity</li></ul></li><li>A Static Web App - hosting a Metaverse? ü§Ø</li><li><strong>Exercise</strong> Deploy the sample yourself following the step-by-step tutorial</li></ul><p><img loading="lazy" src="/assets/images/27-banner-5146de1cca8588633d6475561df82410.png" width="1000" height="420" class="img_E7b_"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="what-is-azure-communications-services-acs">What is Azure Communications Services (ACS)?<a class="hash-link" href="#what-is-azure-communications-services-acs" title="Direct link to heading">‚Äã</a></h2><p><a href="https://docs.microsoft.com/en-us/azure/communication-services/overview" target="_blank" rel="noopener noreferrer">Azure Communication Services (ACS)</a> is a set of <strong>rich communication, video, and SMS APIs</strong> to deploy your applications across any device, on any platform. If you want to enable emails, chat, audio/video conferencing, phone calls or SMS inside an existing app, this service is right for you. You can view it as your building blocks to create your own custom version of Microsoft Teams, it uses the same underlying infrastructure. This <a href="https://www.forbes.com/advisor/business/software/what-is-cpaas/" target="_blank" rel="noopener noreferrer">CPaaS</a> (Communications Platform As A Service) will manage scalability, quality &amp; availability of this service for you. This platform is also built on top of our secure and compliant cloud.  </p><p>Watch this short video for a quick introduction üëáüèº</p><iframe width="560" height="315" src="https://www.youtube.com/embed/chMHVHLFcao" title="YouTube video player" frameborder="0"></iframe><p>Of course, this service comes with a price. You can find the cost of each service by visiting‚ÄØ<a href="https://azure.microsoft.com/en-us/pricing/details/communication-services/" target="_blank" rel="noopener noreferrer">Azure Communication Services pricing | Microsoft Azure</a>. </p><p>ACS exposes its services via‚ÄØvarious SDKs:‚ÄØ<a href="https://github.com/Azure/communication" target="_blank" rel="noopener noreferrer">Azure Communication Services ‚Äì Samples and Tools</a> available for‚ÄØJavaScript,‚ÄØ.NET,‚ÄØJava,‚ÄØAndroid,‚ÄØiOS‚ÄØ&amp;‚ÄØPython‚ÄØdevelopers. </p><p>You can also optionally use this on top of the ACS UI library:‚ÄØ<a href="https://azure.github.io/communication-ui-library/?path=/story/overview--page" target="_blank" rel="noopener noreferrer">Overview ‚Äì Page ‚ãÖ Storybook</a> which consists of React-based components implementing the‚ÄØ<a href="https://developer.microsoft.com/fluentui/" target="_blank" rel="noopener noreferrer">Microsoft Fluent Design</a>‚ÄØto help you build visually engaging web apps. The best sample mixing all of these concepts is <strong><a href="https://docs.microsoft.com/en-us/azure/communication-services/samples/calling-hero-sample?pivots=platform-web" target="_blank" rel="noopener noreferrer">Group calling hero sample ‚Äì An Azure Communication Services sample overview</a></strong>. </p><p>To give you a brief idea, watch this 2 min video tutorial that shows you how to get the internal ACS authentication token to connect to its infrastructure. I can then join an existing Teams meeting using a simple web page and the ACS JavaScript SDK:</p><iframe width="560" height="315" src="https://www.youtube.com/embed/FFBBLUtRyZw" title="YouTube video player" frameborder="0"></iframe><p><strong>Want to follow along at home?</strong> You simply need to:</p><ul><li><a href="https://docs.microsoft.com/en-us/azure/communication-services/quickstarts/create-communication-resource?tabs=windows&amp;pivots=platform-azp" target="_blank" rel="noopener noreferrer">Create an Azure Communication Services resource in your Azure Portal</a> </li><li>Navigate to <a href="https://aka.ms/acsquicktest" target="_blank" rel="noopener noreferrer">https://aka.ms/acsquicktest</a> and follow the video tutorial above.</li></ul><p>You‚Äôll discover that, by default, Azure Communication Services provides the basic authentication &amp; identity layer. But you need to build on top of it to connect your own identity platform. Let‚Äôs see how to do that, next!</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="building-an-authentication-layer-with-azure-function-cosmosdb--static-web-app">Building an authentication layer with Azure Function, CosmosDB &amp; Static Web App<a class="hash-link" href="#building-an-authentication-layer-with-azure-function-cosmosdb--static-web-app" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="1-azure-static-web-apps---social-authentication">1. Azure Static Web Apps - social authentication<a class="hash-link" href="#1-azure-static-web-apps---social-authentication" title="Direct link to heading">‚Äã</a></h3><p>Well, it turns out that SWA provides an awesome out of the box authentication experience. To know more about it, please read: <a href="https://docs.microsoft.com/en-us/azure/static-web-apps/authentication-authorization?tabs=invitations" target="_blank" rel="noopener noreferrer">Authentication and authorization for Azure Static Web Apps</a>. In seconds, without any additional code required, you‚Äôll have an authentication layer provided to you!</p><p>We‚Äôre going to use it as our front end to welcome and authenticate our users. </p><h3 class="anchor anchorWithStickyNavbar_mojV" id="2-azure-functions---map-to-acs-identity">2. Azure Functions - map to ACS identity<a class="hash-link" href="#2-azure-functions---map-to-acs-identity" title="Direct link to heading">‚Äã</a></h3><p>Then, we will map their social account identity with the internal ACS identity via an Azure Function. The Azure Function will store the mapping into a small CosmosDB table. Here‚Äôs the flow. </p><p>First, you‚Äôll land on a page asking you to choose your favorite social provider:</p><p><img loading="lazy" alt="Screenshot of the Static Web App sample showing the Twitter, Github, Microsoft &amp;amp; Google logos" src="/assets/images/ACSSWA001-e655d56ddaf55e97d82a83a96250c726.jpg" width="1536" height="610" class="img_E7b_"></p><p>Then, once authenticated, you‚Äôll be directly connected to the Azure Communication Services infrastructure. No need to generate a token or whatever, the Azure Function took care of it. I‚Äôve been using my Twitter account in this screenshot for instance:</p><p><img loading="lazy" alt="Screenshot of the Static Web App sample once authentified, showing the web camera active" src="/assets/images/ACSSWA002-cfcc34d95d25a76a1e84c8d0a8a82873.jpg" width="2256" height="1434" class="img_E7b_"></p><p>You see that the UI shows how my Twitter account, <em>davrous@twitter</em>, is mapped to the internal ACS user ID <em>8:acs:4ba98fcc</em>‚Ä¶ that you should normally not share to the users of course üòâ. </p><p>Thanks to that, you‚Äôre ready to call friends and colleagues immediately or join a Teams meeting via simply using their social account email address as the person to call.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="3-azure-functions--cosmosdb-binding">3. Azure Functions + CosmosDB Binding<a class="hash-link" href="#3-azure-functions--cosmosdb-binding" title="Direct link to heading">‚Äã</a></h3><p>Let‚Äôs have a look to the Azure Function code enabling this scenario. First, you can see in the <a href="https://github.com/davrous/acsauth/blob/main/api/users/function.json" target="_blank" rel="noopener noreferrer">function.json file</a> that I‚Äôm using the CosmosDB binding feature. To know more about this feature:</p><ul><li><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-cosmosdb-v2-input?tabs=in-process%2Cfunctionsv2&amp;pivots=programming-language-javascript" target="_blank" rel="noopener noreferrer">Azure Cosmos DB input binding for Functions 2.x and higher</a></li><li><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-cosmosdb-v2-output?tabs=in-process%2Cfunctionsv2&amp;pivots=programming-language-csharp" target="_blank" rel="noopener noreferrer">Azure Cosmos DB output binding for Functions 2.x and higher</a></li></ul><p>In a nutshell, via a simple declaration in the <em>function.json</em> file, you have a simple data access layer available in your Azure Function code for free. </p><p>If you look into my json file, I‚Äôm defining a route under <em>users/{email}/{lookup:bool?}</em> that will be exposed under 2 functions in my Azure Function: <em>setUser</em> as the output binding (to write or update into CosmosDB) and <em>getUser</em> as the input binding (to read from CosmosDB). </p><p>In this declaration file, I‚Äôm also asking the Azure Function to use the CosmosDB database named ‚Äú<em>ACS</em>‚Äù with the table named ‚Äú<em>users</em>‚Äù using ‚Äú<em>email</em>‚Äù parameter as the partition key. </p><p><em>getUser</em> will be called with a first required parameter which is an email address associated to the ACS internal identity. It has a second optional parameter which is a boolean. This asks to the Azure Function to do a simple resolve query to return the internal ACS id associated with the email address. It‚Äôs useful when you‚Äôd like to call someone on ACS by simply providing his email address rather than being forced to know its internal ACS identity (starting with <em>8:acs:xxx</em>).</p><p><em>setUser</em> simply create a new record or update it.</p><p>You can find the complete source code of the Azure Function there: <a href="https://github.com/davrous/acsauth/blob/main/api/users/index.ts" target="_blank" rel="noopener noreferrer">acsauth/index.ts at main ¬∑ davrous/acsauth (github.com)</a>. </p><p>The first block is simply doing the resolve logic I was mentioning just before. The second block is first checking if the user has already been created in the CosmosDB table and if the ACS token is still valid. Indeed, ACS tokens are valid for 24 hours only. If the user doesn‚Äôt exist or if its token has expired, we‚Äôre using the ACS JavaScript SDK to create a new identity &amp; authentication token to map it to the email address. </p><p>If you‚Äôre interested in the ACS identity concepts, please read:</p><ul><li><a href="https://docs.microsoft.com/en-us/azure/communication-services/concepts/identity-model" target="_blank" rel="noopener noreferrer">Identity model - An Azure Communication Services concept</a></li><li><a href="https://docs.microsoft.com/en-us/azure/communication-services/quickstarts/access-tokens?pivots=programming-language-javascript" target="_blank" rel="noopener noreferrer">Quickstart - Create and manage access tokens - An Azure Communication Services quickstart</a></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="4-cosmosdb---stores-acs-identity-data">4. CosmosDB - stores ACS identity data<a class="hash-link" href="#4-cosmosdb---stores-acs-identity-data" title="Direct link to heading">‚Äã</a></h3><p>Now, let‚Äôs have a look to what‚Äôs stored in the CosmosDB table thanks to the Azure Portal:</p><p><img loading="lazy" alt="Screenshot of Azure Portal, in the CosmosDB blade showing the content of the table" src="/assets/images/ACSSWA003-6bfaf3849bb96b70144a46f3aa55ac37.jpg" width="2196" height="909" class="img_E7b_"></p><p>You can find all the required information for my scenario:</p><ul><li><strong>id</strong>: an email address coming from the social network, which is my partition key and my primary key for my requests</li><li><strong>userId</strong>: the associated internal ACS identity in the form of 8:acs:xxxx.</li><li><strong>userToken</strong>: the associated internal ACS authentication token required to be able to connect to the ACS infrastructure</li><li><strong>expiresOn</strong>: when the ACS authentication token will expire</li></ul><p>The beauty of the Azure Function binding feature is that I didn‚Äôt have to write any code to manage the reading or writing part of the records. It can even update an existing record if needed. </p><p>With few lines of code, I‚Äôve been able to create a small authentication layer on top of ACS to create users mapped to ACS internal identity. With the out of the box Static Web App authentication experience, I didn‚Äôt even need to write any code to authenticate users with their social identity!</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="a-static-web-app-hosting-a-metaverse-">A Static Web App hosting a Metaverse? ü§Ø<a class="hash-link" href="#a-static-web-app-hosting-a-metaverse-" title="Direct link to heading">‚Äã</a></h2><p>In the same sample, I‚Äôve been building on top of the architecture described just above a small metaverse using <a href="https://www.babylonjs.com" target="_blank" rel="noopener noreferrer">Babylon.js</a>, an open source &amp; free WebGL engine I‚Äôve been contributing to. The logic is identical to what I‚Äôve described up to now. </p><p>Thanks to the SWA, I‚Äôm authenticating the user using his social profile. But then, I can do the video call to another ACS user or someone in Teams from a 3D scene. And everything is waayyy cooler inside a 3D scene, right? </p><p><img loading="lazy" alt="Screenshot of the Static Web App with a 3D scene of a museum loaded" src="/assets/images/ACSSWA004-2c90a2336105c38bffc821977311f72f.jpg" width="1914" height="1431" class="img_E7b_"></p><p>But wait, there‚Äôs even better. You can experience this Babylon.js scene in VR thanks to its native WebXR support! To give you an idea, here‚Äôs a video where I‚Äôm using my Valve Index to call my girl friend in Teams so we can visit this museum together.</p><iframe width="560" height="315" src="https://www.youtube.com/embed/Wd4qNeLV_P8" title="YouTube video player" frameborder="0"></iframe><p>If you‚Äôre interested in WebXR, I‚Äôve written a full article on what you can build with it sharing lot of my samples: <a href="https://www.davrous.com/2022/04/12/from-gaming-to-metaverses-building-webxr-apps-with-babylon-js/" target="_blank" rel="noopener noreferrer">From gaming to metaverses, building WebXR apps with Babylon.js ‚Äì David Rousset (davrous.com)</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="exercise">Exercise<a class="hash-link" href="#exercise" title="Direct link to heading">‚Äã</a></h2><p>If you‚Äôd like to play and learn from this sample mixing ACS, SWA, Azure Function, CosmosDB &amp; Babylon.js, you can <strong>deploy it in less than 10 minutes</strong> by following the step-be-step tutorial available in this associated repo: <a href="https://github.com/davrous/acsauth" target="_blank" rel="noopener noreferrer">davrous/acsauth: Deploy in less than 10 min an Azure Communication Services sample to be shared &amp; tested with your colleagues &amp; friends</a>.</p><p>Enjoy and see you in the metaverse! üòä</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/swa">swa</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/30-days">30days</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/best-practices">best-practices</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/page/2"><div class="pagination-nav__label">Newer Entries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/page/4"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 Microsoft  - Built with <a href="https://docusaurus.io"> Docusaurus </a> - Deployed to <a href="https://aka.ms/swa"> Azure </a> - Created by <a href="https://github.com/nitya"> @nitya </a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.cbde678b.js"></script>
<script src="/assets/js/main.a80bf38b.js"></script>
</body>
</html>